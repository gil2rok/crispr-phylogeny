# HERACLES
![License: Apache-2.0](https://img.shields.io/github/license/gil2rok/heracles)

HERACLES algorithm reconstructs CRISPR-Cas9 phylogenetic lineages with hyperbolic embeddings.

**Note: this repo is under active development and is not yet fully functional**

[![HERACLES](data:image/png;base64,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)](img)

## Overview

Insert CRISPR-Cas9 casettes (i.e. cellular "barcodes") into a cell and sequence its descendants to reconstruct the evolutionary cell lineage. Using a CRISPR-specific continous time Markov chain, model the mutations that accumulate on these casettes. Then construct a function to quanitify the likelihood of a particular evolutionary tree, in both tree topology and branch lengths. Approixmate the tree-metric by embedding points in hyperbolic space. Lastly, optimize over the hyperbolic embeddings using Riemannian stochastic gradient descent.

**In plain English:** HERACLES algorithm uses CRISPR gene editing :dna: to insert a "barcode" into a cell. After hundreds of generations of evolution, the cell's descendants will have accumulated mutations on this barcode .

We take a novel approach that involves a bunch of crazy math -- continous time Markov chains, hyperbolic geometry, and gradient-based optimization  -- that allows us to reconstruct the evolutionary tree from these modified barcodes.